[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/tmp/supervisord.pid

# ----------------------------------------------
#  GLOBAL ENVIRONMENT (shared across programs)
# ----------------------------------------------
env = DBUS_SESSION_BUS_ADDRESS="unix:path=/tmp/dbus-session",XDG_RUNTIME_DIR="/tmp/runtime-root",DISPLAY=":0"

# ----------------------------------------------
#  DBUS SESSION
# ----------------------------------------------
[program:dbus]
command=/usr/bin/dbus-daemon --session --address=unix:path=/tmp/dbus-session
autostart=true
autorestart=true
priority=5

# ----------------------------------------------
#  PIPEWIRE + WIREPLUMBER AUDIO STACK
# ----------------------------------------------
[program:pipewire]
command=/usr/bin/pipewire
autostart=true
autorestart=true
priority=10

[program:wireplumber]
command=/usr/bin/wireplumber
autostart=true
autorestart=true
priority=15

# ----------------------------------------------
#  Xorg (headless dummy)
# ----------------------------------------------
[program:xorg]
command=/usr/bin/Xorg :0 -config /etc/X11/xorg.conf.d/20-nvidia-headless.conf -noreset -nolisten tcp -logfile /var/log/Xorg.0.log
autostart=true
autorestart=true
priority=20

# ----------------------------------------------
#  XFCE Desktop
# ----------------------------------------------
[program:xfce]
command=/usr/bin/startxfce4
autostart=true
autorestart=true
priority=25

# ----------------------------------------------
#  Sunshine
# ----------------------------------------------
[program:sunshine]
command=/usr/bin/sunshine
autostart=true
autorestart=true
priority=30
# Sunshine has its own config in /config, so no extra params needed.
