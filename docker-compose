services:
  ubuntu-desktop-sunshine:
    build:
      context: .
      args:
        SUNSHINE_VERSION: "0.24.0"     # change when you want to upgrade
    image: my/ubuntu-desktop-sunshine:0.24.0
    container_name: ubuntu-desktop-sunshine
    # NVIDIA runtime for NVENC (host must have NVIDIA driver + container toolkit)
    deploy: {}
    runtime: nvidia
    environment:
      - PUID=1000              # map to your user
      - PGID=1000              # map to your group
      - TZ=Europe/Copenhagen
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - DISPLAY=:0
      # Optional: webtop variables (e.g., to tweak resolution)
      # - CUSTOM_RES_W=1920
      # - CUSTOM_RES_H=1080
      # - CUSTOM_REFRESH_RATE=60
    shm_size: "1g"
    ports:
      - "47984:47984/tcp"
      - "47989:47989/tcp"
      - "47998-48010:47998-48010/udp"
      # Optional: expose webtop's noVNC for first-run admin (comment if not needed)
      # - "3000:3000"
    volumes:
      - /path/to/config:/config             # Sunshine + desktop settings persist here
      - /path/to/workspace:/workspace       # your projects, repos, assets
      # (Optional) forward host Docker socket for dev workflows
      # - /var/run/docker.sock:/var/run/docker.sock
    devices:
      - /dev/dri:/dev/dri
    restart: unless-stopped
